<%- include('head.ejs') %>
  <style>
    table {
      width: 100%;

      padding-right: 10px;
      border-collapse: collapse;
    }

    tr {
      height: 10px;
      max-height: 10px;
      position: relative;
    }

    .timeAvailable {
      width: 80%;
      margin-left: auto;
      margin-right: auto;
      border-radius: 5px;
      margin-bottom: 5px;
    }
    #tableHolder {
        height:90%;
        border: solid .2px black;
        border-radius: 5px;
        overflow-y:hidden;
        overflow-x: hidden;
        @media (max-width:500px) {
          
        }
      }
    #tablebd{
     height: 418px; 
     overflow-y: auto;
     overflow-x: hidden
    }
      #section1{
        height: 100%;
      }
    @media (min-width:500px) {
  

      #tablebd::-webkit-scrollbar {
        width: 5px;
        /* Width of the scrollbar */
        background-color: #f1f1f1;/
      }

      #tablebd::-webkit-scrollbar-thumb {
        background-color: #888;
        /* Color of the scrollbar thumb */
        border-radius: 10px;
        /* Round corners of the scrollbar thumb */
      }
    }

    @media (max-width:500px) {
      #Searcher {
        width: 300px;
      }

      #Searcher button {
        width: 30%;
        font-size: 12px;
        padding: 0;
      }

      .btn {
        font-size: 12px;

      }
    }

#thead>.col-3{
  text-align: center;
  padding: 5px;
  font-weight: bold;
  color: black;
  font-size: 14px;
}
    @media (min-width:500px) {

    }

    .createSched_btn {
      @media (max-width:500px) {
        font-size: 13px;
      }
    }
    #dateANDtime{
      @media (max-width:500px) {
        margin-top: 10px;
      }
    }
    #schedule_maker{
      position: absolute;
      bottom: 3%;   
      @media (max-width:500px) {
       bottom: 4%;   
      }
      
    }
    .overLay{
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: rgba(255, 255, 255, 0.502);
      height: 100%;
      width: 100%;
      border: solid .2px rgb(0, 0, 0);
      backdrop-filter: blur(2px);
      border-top:  solid .1px rgba(155, 155, 155, 0.493);
      border-bottom: solid .1px rgba(155, 155, 155, 0.493);
      border-left: none;
      border-right: none;
      text-align: center;
    color: red;
      padding-top: auto;
      padding-bottom: auto;
      display: flex; 
      justify-content: center; 
      align-items: center;
      font-weight: bold;
    
    }
    .overLay.Finish{
      color: #538135;
    }
  @media (min-width:500px) {
    .overLay:hover{
      color:transparent;
      backdrop-filter: blur(0px);
      background-color: transparent;
      transition: background-color .2s,backdrop-filter .2s;
    }
  }
  @media (max-width:500px) {
    .overLay.show{
      color:transparent;
      backdrop-filter: blur(0px);
      background-color: transparent;
      transition: background-color .2s,backdrop-filter .2s;
    }
  }
  .col{text-align: center;}
  .col-3{
    font-size: 15px;
    padding-top: 10px;
    padding-bottom: 10px;
  @media (max-width:500px) {
   text-align: center;
    margin-top: auto;
    margin-bottom: auto;
 font-size: 12px;
}
  }
  </style>


  <link rel="stylesheet" type="text/css" href="../calendar/calendar.css" />



  <div class="col-10" id="content">
<script> const scheds = "<%= schedsID %>";</script>
 
    <div class="form-control" id="maincontent" style=" padding: 10px;position: relative;">

      <div id="section1">
        <div class="btn btn-success" id="schedule_maker"><img
            src="../img/schedulemake.png" id="" class="navbaricon" alt="">Make Schedule</div>

        <div id="tableHolder">
          <div id="schedules_table">
            <div id="noData" >
             <div style="text-align: center;">No Schedule</div>
             <div style="text-align: center;font-size: 12px;font-weight: normal;" >(To create a schedule click the "Make Schedule" button assigned below)</div>
            
            </div>
            <div id="thead" style="position: sticky;top: 0;color: black; background-color: #b6d8a0;" class="row">
              <div class="col-3" id="HeadName">Name</div>
              <div class="col-3">Time</div>
              <div class="col-3">Date</div>
              <div class="col-3">Status</div>
            </div>
            <div id="tablebd"></div>
          </div>
         
        </div>

      </div>
      <div id="section2">
        <form action="/createSchedule" method="post" class="form-control" id="ScheduleCreatorForm">
          <div style="text-align: center;margin-bottom: 30px;">
            <h4>Consultation Purpose</h4>
          </div>
          <div class="row">
            <div class="col-sm-4">
              <div class="input-group ">
                <span class="input-group-text">
                  ID
                </span>
                <input type="hidden" id="resched_status" name="reSched">
                <input type="text" id="ScheduledID" class="form-control" name="ScheduledID">
                <span class="input-group-text">
                  Name
                </span>
                <input type="text" class="form-control" id="ScheduledNAME" name="ScheduledNAME">
              </div>
            </div>

            <div class="col-sm-2">

            </div>
<div class="col-sm-6" id="dateANDtime">
  <div class="row">
                <div class="col-sm-6">
    
                  <div class="input-group">
                    <span class="input-group-text">Date</span>
                    <input type="text" class="form-control" id="PreferredDate" name="PreferredDate">
                  </div>
                </div>
                <div class="col-sm-6" >
                  <div class="input-group">
                    <span class="input-group-text">
                      Time
                    </span>
                    <input type="text" class="form-control" id="PreferredTin" name="PreferredTin">
                    <span class="input-group-text">
                      -
                    </span>
                    <input type="text" class="form-control" id="PreferredTout" name="PreferredTout">
                  </div>
                </div>
    
  </div>
</div>

          </div>

          <textarea class="form-control" placeholder="Purpose." name="purpose" id="purpose" rows="5"
            cols="30"></textarea>
          <div class="row">
            <div class="col-4">
              <button type="button" class="createSched_btn form-control btn-primary"
                onclick="showThis(3);">Back</button>
            </div>
            <div class="col-4"></div>
            <div class="col-4">
              <button type="submit" class="form-control btn-success createSched_btn">Submit</button>
            </div>
          </div>
        </form>
      </div>
      <div id="section3">

        <div id="calendarMain">

          <center>
            <div id="calendar-nav">
              <button id="prev" class="form-control" onclick="prevWeekBtn()">&lt</button>
              <h4 class="currentDate" id="monthtitle"></h4>
              <button id="next" class="form-control" onclick="nextWeekBtn()">&gt</button>
            </div>
          </center>


          <div id="calendar-body">
            
          </div>
          <div style="margin-top: 5%;margin-left: auto;margin-right: auto;text-align: center;font-size: 13px;">(Click the highligted date to view the available time for the remaining slots)</div>
        </div>
        <button style="position: absolute;bottom: 15px;left: 15px;" class="btn-primary btn"
          onclick="showThis(1)">Back</button>
        <button style="position: absolute;bottom: 15px;right: 15px;" class="btn-primary btn"
          onclick="makeSched.show()">Search Again</button>
      </div>

    </div>
  </div>


  </div>
  </div>

<div class="modal fade" id="showMore" tabindex="-1" data-bs-backdrop="true" data-bs-keyboard="false" role="dialog"
aria-labelledby="modalTitleId" aria-hidden="true">
<div class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal-sm" role="document">
  <div class="modal-content">
    <div class="modal-header">
      <h5 class="modal-title" id="showMoreTitle">
        Consultation Details
      </h5>
      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
    </div>

      <div class="modal-body" id="showMoreBody">
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          Close
        </button>
      </div>

    </form>
  </div>
</div>
</div>

<div class="modal fade" id="studentNewSched" tabindex="-1" data-bs-backdrop="true" data-bs-keyboard="false" role="dialog"
aria-labelledby="modalTitleId" aria-hidden="true">
<div class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal-sm" role="document">
  <div class="modal-content">
    <div class="modal-header">
      <h5 class="modal-title" id="showMoreTitle">
        Alert
      </h5>
      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
    </div>
      <div class="modal-body" id="studentNewSchedBody">
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" id="studentNewSchedClose">
          Close
        </button>
      </div>

    </form>
  </div>
</div>
</div>

  <div class="modal fade" id="finishForm" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false" role="dialog"
    aria-labelledby="modalTitleId" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal-sm" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="modalTitleId">
            Consultation Completion Form
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <form action="/update/completed" method="post" id="completionForm">

          <div class="modal-body" id="completionFormBody">
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
              No
            </button>
            <button type="submit" class="btn btn-success">Yes</button>
          </div>

        </form>
      </div>
    </div>
  </div>

  <div class="toast-container position-fixed end-0 p-3 top-0 start-50 translate-middle-x" id="toastContainer"> <!-- Toast elements will be injected here by JavaScript --> </div>


  <div class="modal fade" id="makeSched" tabindex="-1" data-bs-backdrop="true" data-bs-keyboard="false" role="dialog"
    aria-labelledby="modalTitleId" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal-md" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="modalTitleId">
           See Available Time
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <style>
#labelForid{
position: absolute;
z-index: 5;
height: 5px;
left:2.5%;
top: 50%;
font-size: 12px;
font-weight: bold;
opacity: 50%;
}
        </style>
        <div class="modal-body" style="height: 100px;position: relative;"> 
         
          <div class="input-group" id="Searcher" style="padding-top:15px ;">
            <label for="target_id" id="labelForid">ID Number or Name</label>
           
            <input type="text" class="form-control" list="list_id_number" name="" id="target_id"style="padding-top:15px ;" >
            
            <input type="hidden" id="forNameSearch">
            <button id="availability" class="btn btn-primary">Search</button>
            <datalist id="list_id_number">

            </datalist>
          </div>
          <div id="helpTEXT1" style="text-align: center;font-size: 10px;font-weight: bold;margin-left: auto;margin-right: auto;" >"Please input the <div style="display: inline;" id="targets">faculty member's</div> name or ID number to view their available time."</div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-danger" data-bs-dismiss="modal">
            Cancel
          </button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="AvailableTimeModal" tabindex="-1" data-bs-backdrop="true" data-bs-keyboard="false"
    role="dialog" aria-labelledby="modalTitleId" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal-sm" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="modalTitleId">
            Available Consultation Time
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"
            onclick="closeremove()"></button>
        </div>
        <div class="modal-body" id="FacultyTimeContainer">
         <div class="row" >
          <div class="container-fluid"id="morning">

          </div>
         </div> 
         <div class="row">
          <div class="container-fluid" id="afternoon">

          </div>
         </div> 
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" onclick="closeremove()">
            Cancel
          </button>
          <button type="button" class="btn btn-primary" id="submitscheduletime" onclick="ScheduleTime()">Select
            Time</button>
        </div>
      </div>
    </div>
  </div>
</div>
</div>
  <input type="hidden" id="loginDate" value=<%=date %>>

  <input type="hidden" id="loginRole" value=<%=role %>>



<script>
document.addEventListener("DOMContentLoaded",function(){
  if(window.innerWidth<500){
    document.getElementById('helpTEXT1').style.marginTop='12%'
  }else{
     document.getElementById('helpTEXT1').style.marginTop='10%'
  }
})
</script>




<div
  class="modal fade"
  id="Finisher"
  tabindex="-1"
  data-bs-backdrop="static"
  data-bs-keyboard="false"
  
  role="dialog"
  aria-labelledby="modalTitleId"
  aria-hidden="true"
>
  <div
    class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal-sm"
    role="document"
  >
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="modalTitleId">
          Consultation Completion
        </h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
       <div class="container-fluid">
        <div class="row" id="OTPcompletion">
          <p style="margin-bottom: 5px;text-align: center;font-size: 13px;font-weight: bold;">Please input the one-time pin (OTP) that you can obtain from the student you consulted with.</p>
          <input type="number"
          id="otp1"class="InputOTP col">
          <input type="number"  id="otp2"class="InputOTP col">
          <input type="number"  id="otp3"class="InputOTP col">
          <input type="number"  id="otp4"class="InputOTP col">
          <input type="number"  id="otp5"class="InputOTP col">
          <input type="number"  id="otp6"class="InputOTP col">
        </div>
       </div>
        <div class="form-check">
          <input class="form-check-input" type="radio" name="flexRadioDefault" id="choice1" checked>
          <label class="form-check-label" for="choice1">
           Consultation Completed
          </label>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="radio" name="flexRadioDefault" id="choice2" >
          <label class="form-check-label" for="choice2">
            Consultation Unsuccessful
          </label>
        </div>
        
        
      </div>
      <div class="modal-footer">
        <button
          type="button"
          class="btn btn-secondary"
          data-bs-dismiss="modal"
        >
          Cancel
        </button>
        <button type="button" class="btn btn-primary" id="completionBTN">Submit</button>
      </div>
    </div>
  </div>
</div>
<style>
  .InputOTP{
    margin: 3px;

  }
  input[type='number']::-webkit-inner-spin-button {
    -webkit-appearance: none;
    margin: 0;
  }
</style>

<script>
  
  document.getElementById("completionBTN").disabled=true
  document.querySelectorAll(".form-check-input").forEach(element=>{
     element.addEventListener("click",function(){
      const inputs = document.querySelectorAll(".InputOTP");
    let allFilled = true;

    inputs.forEach(input => {
      if (input.value === '') {
        allFilled = false;
      }
    });
      let condition1=document.getElementById("choice1").checked
      if(condition1){
        
document.getElementById("OTPcompletion").style.display=""
if (allFilled) {
      document.getElementById("completionBTN").disabled = false;
    }else{
document.getElementById("completionBTN").disabled=true
    }

  }else{
document.getElementById("OTPcompletion").style.display="none"
document.getElementById("completionBTN").disabled=false
  }
     })
  })

document.querySelectorAll(".InputOTP").forEach(function(el) {
    el.addEventListener("keydown",function(e){
        const otpid = el.id;
        const lastChar = parseInt(otpid.charAt(otpid.length - 1));
        const id = lastChar - 1;
        const nextInput = document.getElementById(`otp${id}`); 
        if(e.keyCode==8){
            if(el.value==''){
            nextInput.focus();
          }
          document.getElementById("completionBTN").disabled=true
     
        } 
        const inputs = document.querySelectorAll(".InputOTP");
    let allFilled = true;

    inputs.forEach(input => {
      if (input.value == '') {
        allFilled = false;
      }
    });
    if (allFilled) {
      document.getElementById("completionBTN").disabled = false;
    }
   
    })
    el.addEventListener("input", function(e) {
        const otpid = el.id;
        const lastChar = parseInt(otpid.charAt(otpid.length - 1));
        const id = lastChar + 1;
        if (el.value !== null && el.value !== '') {
            el.value = el.value.slice(-1);
             }
        if (el.value > 0 && el.value < 10) {
            const nextInput = document.getElementById(`otp${id}`);
            if (nextInput) {
                nextInput.focus();
            }else{
              document.getElementById("completionBTN").disabled=false
                document.getElementById("completionBTN").focus()
                
            }
        }
        
    });
});

</script>


  <div class="modal fade" id="declineForm" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false"
    role="dialog" aria-labelledby="modalTitleId" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal-sm" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="modalTitleId">
            Decline Form
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">



          <textarea class="form-control" placeholder="reason" name="reason" id="reason" rows="5" cols="30"></textarea>




        </div>
        <div class="modal-footer">
          <button id="cancelbtn" type="button" class="btn btn-secondary" data-bs-dismiss="modal">
            Close
          </button>
          <button id="confirmbtn" class="btn btn-primary">Save</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="otpContainer" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false"
    role="dialog" aria-labelledby="modalTitleId" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal-sm" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="modalTitleId">
        One Time Pin
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body" >
          <div class="container-fluid" >
            <div class="row">
              <div class="col-12">
<p style="text-align: justify;font-size: 15px;margin-bottom: 5px;">You have requested a one-time password (OTP) for verification purposes. Please use the OTP below within the next <b>5 minutes. </b></p>
              </div>
            </div>
            <div class="row" id="StudentOTP">


            </div>
            <div class="row">
              <div class="col-12">
<p style="text-align: center;font-size: 12px;font-weight: bolder;">Give the above OTP to the instructor you consulted.</p>
              </div>
            </div>
          </div>


          

        </div>
        <div class="modal-footer">
          <button id="cancelbtn" type="button" class="btn btn-secondary" data-bs-dismiss="modal">
            Close
          </button>
        
        </div>
      </div>
    </div>
  </div>










  <div class="modal fade" id="Notifmodal" tabindex="-1" data-bs-backdrop="true" data-bs-keyboard="false" role="dialog"
    aria-labelledby="modalTitleId" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal-md" role="document">
      <div class="modal-content">
        <form action="/notify" class="" id="notif_sender" method="post">
          <div class="modal-header">
            <h5 class="modal-title" id="modalTitleId">
              Student Notifier
            </h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"
              onclick="notif_close()"></button>
          </div>
          <div class="modal-body">

            <label for="receiver_id">Student ID/Name</label>
            <input type="text" class="form-control input" list="studentList" name="R_id" id="receiver_id" required>

            <label for="msg">Message</label>

            <textarea class="form-control input-text" placeholder="" name="msg" id="msg" cols="30" required></textarea>

          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" onclick="notif_close()">
              Close
            </button>
            <button type="submit" id="notifsub" class="btn btn-primary">Submit</button>
        </form>
      </div>
    </div>
  </div>
</div>
<div class="modal fade" id="confirmationModal" tabindex="-1" data-bs-backdrop="true" data-bs-keyboard="false" role="dialog"
aria-labelledby="modalTitleId" aria-hidden="true">
<div class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal-md" role="document">
  <div class="modal-content">
    
      <div class="modal-header">
        <h4 class="modal-title" style="text-align: center;margin-left: auto;margin-right: auto;" id="modalTitleId">
          Attention!
        </h4>
        
      </div>
      <div class="modal-body">
        <div id="msgForConfirm"></div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-danger" id="noBtn" style="position: absolute;left: 4%;">
          No
        </button>
        <button type="submit" id="yesBtn" class="btn btn-primary">Yes</button>
  </div>
</div>
</div>





<script>
  document.addEventListener("DOMContentLoaded",function(){
    fetch('/load/pg_role').then(response=>response.json()).then(data=>{
      const the_head=document.getElementById('HeadName')
     
if(data.role=='student'){

          the_head.innerHTML=`Name of Faculty`
        
}else{   
  the_head.innerHTML=`Name of Student
  `}
}).catch(err=>{

})
  })


  
</script>

  <script src="../bootjs/boostrap.js"></script>
  <script src="../home_script.js"></script>
  <script src="../responsive_script.js"></script>
  <script src="../calendar/calendar.js"></script>

  </body>

  </html>